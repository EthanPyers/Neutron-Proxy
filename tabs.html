<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chrome-like Browser</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background-color: #202124;
            color: #e8eaed;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .browser-header {
            background-color: #292a2d;
            border-bottom: 1px solid #3c4043;
        }

        /* Tabs Bar */
        .tabs-bar {
            display: flex;
            align-items: center;
            height: 36px;
            padding: 0 5px;
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .tabs-bar::-webkit-scrollbar {
            display: none;
        }

        .tab {
            display: flex;
            align-items: center;
            min-width: 180px;
            max-width: 240px;
            height: 32px;
            margin-right: 5px;
            padding: 0 10px;
            background-color: #323639;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
            flex-shrink: 1;
        }

        .tab.active {
            background-color: #3c4043;
        }

        .tab-favicon {
            width: 16px;
            height: 16px;
            margin-right: 8px;
            flex-shrink: 0;
        }

        .tab-title {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: #e8eaed;
            font-size: 12px;
            flex-grow: 1;
        }

        .tab-close {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 5px;
            flex-shrink: 0;
        }

        .tab-close:hover {
            background-color: #5f6368;
        }

        .new-tab {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: transparent;
            color: #e8eaed;
            cursor: pointer;
            flex-shrink: 0;
        }

        .new-tab:hover {
            background-color: #5f6368;
        }

        /* URL Bar */
        .url-bar-container {
            display: flex;
            align-items: center;
            padding: 8px 16px;
        }

        .browser-actions {
            display: flex;
            margin-right: 10px;
        }

        .action-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #e8eaed;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .action-btn:hover {
            background-color: #5f6368;
        }

        .url-bar-wrapper {
            flex-grow: 1;
            display: flex;
            align-items: center;
            height: 40px;
            background-color: #3c4043;
            border-radius: 20px;
            padding: 0 15px;
            margin: 0 10px;
        }

        .url-bar {
            flex-grow: 1;
            height: 100%;
            background: transparent;
            border: none;
            outline: none;
            color: #e8eaed;
            font-size: 14px;
            padding: 0 10px;
        }

        .url-bar-icon {
            color: #9aa0a6;
        }

        .browser-menu {
            display: flex;
        }

        /* Content Area */
        .content-area {
            flex-grow: 1;
            overflow: hidden;
        }

        .tab-content {
            width: 100%;
            height: 100%;
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
    </style>
</head>
<body>
    <div class="browser-header">
        <div class="tabs-bar" id="tabs-bar">
            <!-- Initial tab -->
            <div class="tab active" data-url="/index.html">
                <img class="tab-favicon" src="https://www.google.com/s2/favicons?domain=same.new" alt="favicon">
                <span class="tab-title">Home</span>
                <div class="tab-close">
                    <i class="fa-solid fa-xmark fa-xs"></i>
                </div>
            </div>
            <div class="new-tab" id="new-tab-btn">
                <i class="fa-solid fa-plus"></i>
            </div>
        </div>
        <div class="url-bar-container">
            <div class="browser-actions">
                <div class="action-btn" id="back-btn">
                    <i class="fa-solid fa-arrow-left"></i>
                </div>
                <div class="action-btn" id="forward-btn">
                    <i class="fa-solid fa-arrow-right"></i>
                </div>
                <div class="action-btn" id="reload-btn">
                    <i class="fa-solid fa-rotate-right"></i>
                </div>
            </div>
            <div class="url-bar-wrapper">
                <i class="fa-solid fa-lock url-bar-icon"></i>
                <input type="text" class="url-bar" id="url-bar" placeholder="Search or enter website name">
            </div>
            <div class="browser-menu">
                <div class="action-btn">
                    <i class="fa-solid fa-ellipsis-vertical"></i>
                </div>
            </div>
        </div>
    </div>
    <div class="content-area" id="content-area">
        <!-- Tab contents will be dynamically added here -->
        <div class="tab-content active" id="tab-content-0">
            <iframe src="/index.html" id="frame-0" onload="updateTabInfo(0)"></iframe>
        </div>
    </div>

    <script>
        // Global variables
        let activeTabId = 0;
        let tabCounter = 1; // Start with 1 since we already have tab with id 0
        const maxTabWidth = 240;
        const minTabWidth = 40;
        const defaultTabWidth = 180;

        // DOM elements
        const tabsBar = document.getElementById('tabs-bar');
        const contentArea = document.getElementById('content-area');
        const urlBar = document.getElementById('url-bar');
        const newTabBtn = document.getElementById('new-tab-btn');
        const backBtn = document.getElementById('back-btn');
        const forwardBtn = document.getElementById('forward-btn');
        const reloadBtn = document.getElementById('reload-btn');

        // Event listeners
        urlBar.addEventListener('keydown', handleUrlSubmit);
        newTabBtn.addEventListener('click', createNewTab);
        backBtn.addEventListener('click', goBack);
        forwardBtn.addEventListener('click', goForward);
        reloadBtn.addEventListener('click', reloadPage);
        window.addEventListener('resize', resizeTabs);

        // Function to handle URL submissions
        function handleUrlSubmit(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                let url = urlBar.value.trim();

                // If the input is a search query (no protocol, no dot)
                if (!url.includes('://') && !url.includes('.')) {
                    url = `/active/embed.html?url=https://www.bing.com/search?q=${encodeURIComponent(url)}`;
                }
                // If it's a domain without protocol, add it
                else if (!url.includes('://')) {
                    url = `/active/embed.html?url=http://${url}`;
                }
                // If it's a full URL
                else {
                    url = `/active/embed.html?url=${encodeURIComponent(url)}`;
                }

                // Update the iframe source
                const activeFrame = document.getElementById(`frame-${activeTabId}`);
                activeFrame.src = url;
            }
        }

        // Function to update the tab information
        function updateTabInfo(tabId) {
            try {
                const frame = document.getElementById(`frame-${tabId}`);
                const tab = document.querySelector(`.tab[data-tab-id="${tabId}"]`);

                if (!frame.contentDocument) return; // If cross-origin, cannot access

                // Update tab title from iframe document title
                const title = frame.contentDocument.title || 'New Tab';
                const tabTitle = tab.querySelector('.tab-title');
                tabTitle.textContent = title;

                // Extract the actual URL from embedded URL
                let frameUrl = frame.src;
                if (frameUrl.includes('/active/embed.html?url=')) {
                    const encodedUrl = frameUrl.split('/active/embed.html?url=')[1];
                    frameUrl = decodeURIComponent(encodedUrl);
                }

                // Update URL bar
                if (tabId === activeTabId) {
                    urlBar.value = frameUrl;
                }

                // Update favicon
                const domain = extractDomain(frameUrl);
                const favicon = tab.querySelector('.tab-favicon');
                favicon.src = `https://www.google.com/s2/favicons?domain=${domain}`;

                // Store URL in tab's dataset
                tab.dataset.url = frameUrl;
            } catch (error) {
                console.error("Error updating tab info:", error);
            }
        }

        // Function to extract domain from URL
        function extractDomain(url) {
            try {
                // Handle special cases for our local paths
                if (url === '/index.html') return 'same.new';
                if (url.startsWith('/active/embed.html')) {
                    const encodedUrl = url.split('/active/embed.html?url=')[1];
                    url = decodeURIComponent(encodedUrl);
                }

                // Extract domain from URL
                const urlObj = new URL(url);
                return urlObj.hostname;
            } catch (error) {
                return 'same.new'; // Default fallback
            }
        }

        // Function to create a new tab
        function createNewTab() {
            const tabId = tabCounter++;

            // Create new tab element
            const tab = document.createElement('div');
            tab.className = 'tab';
            tab.dataset.tabId = tabId;
            tab.dataset.url = '/index.html';
            tab.innerHTML = `
                <img class="tab-favicon" src="https://www.google.com/s2/favicons?domain=same.new" alt="favicon">
                <span class="tab-title">New Tab</span>
                <div class="tab-close">
                    <i class="fa-solid fa-xmark fa-xs"></i>
                </div>
            `;

            // Insert before the new tab button
            tabsBar.insertBefore(tab, newTabBtn);

            // Create tab content
            const tabContent = document.createElement('div');
            tabContent.className = 'tab-content';
            tabContent.id = `tab-content-${tabId}`;
            tabContent.innerHTML = `<iframe src="/index.html" id="frame-${tabId}" onload="updateTabInfo(${tabId})"></iframe>`;
            contentArea.appendChild(tabContent);

            // Attach event listeners
            tab.addEventListener('click', () => switchTab(tabId));
            tab.querySelector('.tab-close').addEventListener('click', (e) => {
                e.stopPropagation();
                closeTab(tabId);
            });

            // Switch to the new tab
            switchTab(tabId);
            resizeTabs();
        }

        // Function to switch between tabs
        function switchTab(tabId) {
            // Deactivate current active tab
            document.querySelector('.tab.active').classList.remove('active');
            document.querySelector('.tab-content.active').classList.remove('active');

            // Activate the selected tab
            const selectedTab = document.querySelector(`.tab[data-tab-id="${tabId}"]`);
            const selectedContent = document.getElementById(`tab-content-${tabId}`);

            selectedTab.classList.add('active');
            selectedContent.classList.add('active');

            // Update active tab ID
            activeTabId = tabId;

            // Update URL bar
            urlBar.value = selectedTab.dataset.url;
        }

        // Function to close a tab
        function closeTab(tabId) {
            const tab = document.querySelector(`.tab[data-tab-id="${tabId}"]`);
            const tabContent = document.getElementById(`tab-content-${tabId}`);

            // Check if closing the active tab
            const isActive = tab.classList.contains('active');

            // Remove elements
            tab.remove();
            tabContent.remove();

            // If we closed the active tab, switch to another tab
            if (isActive && document.querySelectorAll('.tab').length > 1) {
                // Get the first remaining tab
                const firstTabId = document.querySelector('.tab').dataset.tabId;
                switchTab(firstTabId);
            }

            // If no tabs left (except the new tab button), create a new tab
            if (document.querySelectorAll('.tab').length === 0) {
                createNewTab();
            }

            // Resize remaining tabs
            resizeTabs();
        }

        // Function to resize tabs based on available space
        function resizeTabs() {
            const tabs = document.querySelectorAll('.tab');
            const availableWidth = tabsBar.clientWidth - newTabBtn.clientWidth - 20; // 20px for padding

            // Calculate width per tab
            let widthPerTab = Math.min(
                maxTabWidth,
                Math.max(minTabWidth, availableWidth / tabs.length)
            );

            // Apply width to each tab
            tabs.forEach(tab => {
                tab.style.width = `${widthPerTab}px`;

                // If tabs are very narrow, hide text and show only favicon
                if (widthPerTab < 80) {
                    tab.querySelector('.tab-title').style.display = 'none';
                    if (widthPerTab < 60) {
                        tab.querySelector('.tab-close').style.display = 'none';
                    } else {
                        tab.querySelector('.tab-close').style.display = '';
                    }
                } else {
                    tab.querySelector('.tab-title').style.display = '';
                    tab.querySelector('.tab-close').style.display = '';
                }
            });
        }

        // Browser navigation functions
        function goBack() {
            const activeFrame = document.getElementById(`frame-${activeTabId}`);
            activeFrame.contentWindow.history.back();
        }

        function goForward() {
            const activeFrame = document.getElementById(`frame-${activeTabId}`);
            activeFrame.contentWindow.history.forward();
        }

        function reloadPage() {
            const activeFrame = document.getElementById(`frame-${activeTabId}`);
            activeFrame.contentWindow.location.reload();
        }

        // Initialize: Add event listeners to the initial tab
        document.querySelector('.tab').dataset.tabId = "0";
        document.querySelector('.tab').addEventListener('click', () => switchTab(0));
        document.querySelector('.tab .tab-close').addEventListener('click', (e) => {
            e.stopPropagation();
            closeTab(0);
        });

        // Initial resize of tabs
        resizeTabs();
    </script>
</body>
</html>
